dist: precise
language: python

python:
  - "2.7"
  - "3.5"

branches:
  only:
    - master
    - beta
    - develop

env:
    - Drivers=True    # First in build mx because long duration
    - Algorithms=True 
    - AlgorithmsB=True
    - Default=True    # construction, io, objects, tools, optimize
    - Report=True      
    - ReportB=True
    - MPI=True        

before_install:
  - sudo apt-get -qq update
  - sudo apt-get -qq install gfortran libblas-dev liblapack-dev
  - sudo apt-get -qq install openmpi-bin openmpi-common openssh-client openssh-server libopenmpi1.3 libopenmpi-dbg libopenmpi-dev > /dev/null
  - travis_wait 30 "sudo bash CI/install.sh > /dev/null 2>&1"
  - "export DISPLAY=:99.0"
  - "sh -e /etc/init.d/xvfb start" #some tests require a display
  - sleep 3 # give xvfb some time to start

install:
  - pip install zmq coverage >/dev/null
  - pip install -e .[complete]
  
cache:
  pip: true
  timeout: 1000

#Script For default "test" stage
script:
  - cd test
  # Output something every 10 minutes or Travis kills the job
  - while sleep 540; do echo "=====[ $SECONDS seconds still running ]====="; done &
  - python travisTests.py # produces test_packages/testCmd.sh
  - cd test_packages
  - bash testCmd.sh  
  - kill %1 # Killing background sleep loop
  - cd ../..

jobs:
  include:
    - stage: deploy
      python: 3.5
      env: Drivers=False Algorithms=False AlgorithmsB=False Default=False Report=False ReportB=False MPI=False
      script: python CI/deploy

notifications:
    email:
        on_success: change
        on_failure: always

